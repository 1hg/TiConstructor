#define USE_HEXDUMP
#define USE_WAIT8
#define USE_CPU_SPEED
#define USE_NUMBER
#include "../../lib/essentials.c"
#include "../../lib/textio.c"
#include "../../lib/misc.c"
#include "../../lib/userinput.c"
#include "../../lib/variables.c"





#define G_MAX_ROW 32/8
#define G_ROW_END  0x80 + 64
#define G_SCREEN_BUFFER _scoreboard_DATA
#define NO_USE_CLEAR
#define G_COL_START 0x20 + 12 - 4

#include "../../lib/graphics.c"

#define NO_MICRO_WAIT 
// #define ON_GREY_RENDER() __asm call _swap __endasm
#include "../../lib/greyscale.c"

// #define NO_USE_SWAP
// #define NO_USE_CLEAR



#define X_LINE 8
#define Y_MULT 		add	hl,hl \
				   	add	hl,hl \
				   	add	hl,hl
#define COPY_MODE or
#define GREYSCALE_SPRITES
#include "../../lib/spritemanager.c"





#define dataName addAppVarObj("gryCfg") // need to add type data to appVar name

#define gameName addAppVarObj("v2048s") // store 2048 board


#define gameData 0x84F3
#define animation_values 0x983C
#include "calibration.c"



const char b2_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000011, 0b10000100, 0b10000000, 0b10000001, 0b10000010, 0b10000100, 0b10000111, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b10000010, 0b01000010, 0b10000010, 0b00000010, 0b00000010, 0b00000010, 0b11000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000011, 0b10000100, 0b10000000, 0b10000001, 0b10000010, 0b10000100, 0b10000111, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b10000010, 0b01000010, 0b10000010, 0b00000010, 0b00000010, 0b00000010, 0b11000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b2_WIDTH 16/8
#define b2_HEIGHT 15
// greyPutSprite(x, y, b2_WIDTH, b2_HEIGHT, b2_DATA);
const char b4_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000001, 0b10000010, 0b10000100, 0b10000111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b10000010, 0b10000010, 0b10000010, 0b10000010, 0b11000010, 0b10000010, 0b10000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000001, 0b10000010, 0b10000100, 0b10000111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b10000010, 0b10000010, 0b10000010, 0b10000010, 0b11000010, 0b10000010, 0b10000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b4_WIDTH 16/8
#define b4_HEIGHT 15
// greyPutSprite(x, y, b4_WIDTH, b4_HEIGHT, b4_DATA);
const char b8_DATA[] ={0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000011, 0b10000100, 0b10000100, 0b10000011, 0b10000100, 0b10000100, 0b10000011, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b10000010, 0b01000010, 0b01000010, 0b10000010, 0b01000010, 0b01000010, 0b10000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b8_WIDTH 16/8
#define b8_HEIGHT 15
// greyPutSprite(x, y, b8_WIDTH, b8_HEIGHT, b8_DATA);
const char b16_DATA[] ={0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10001000, 0b10011000, 0b10001001, 0b10001001, 0b10001001, 0b10001001, 0b10011100, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b01100010, 0b10000010, 0b00000010, 0b11100010, 0b00010010, 0b00010010, 0b11100010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b16_WIDTH 16/8
#define b16_HEIGHT 15
// greyPutSprite(x, y, b16_WIDTH, b16_HEIGHT, b16_DATA);
const char b32_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11000001, 0b11111011, 0b11110111, 0b11111011, 0b11111101, 0b11011101, 0b11100011, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b10001110, 0b01110110, 0b11101110, 0b11011110, 0b10111110, 0b01111110, 0b00000110, 0b11111110, 0b11111110, 0b11111110, 0b11111110};
#define b32_WIDTH 16/8
#define b32_HEIGHT 15
// greyPutSprite(x, y, b32_WIDTH, b32_HEIGHT, b32_DATA);
const char b64_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11110011, 0b11101111, 0b11011111, 0b11000011, 0b11011101, 0b11011101, 0b11100011, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11101110, 0b11001110, 0b10101110, 0b01101110, 0b00000110, 0b11101110, 0b11101110, 0b11111110, 0b11111110, 0b11111110, 0b11111110};
#define b64_WIDTH 16/8
#define b64_HEIGHT 15
// greyPutSprite(x, y, b64_WIDTH, b64_HEIGHT, b64_DATA);
const char b128_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10010011, 0b10110000, 0b10010001, 0b10010010, 0b10111011, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00111010, 0b10101010, 0b00111010, 0b00101010, 0b10111010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10010011, 0b10110000, 0b10010001, 0b10010010, 0b10111011, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00111010, 0b10101010, 0b00111010, 0b00101010, 0b10111010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b128_WIDTH 16/8
#define b128_HEIGHT 15
// greyPutSprite(x, y, b128_WIDTH, b128_HEIGHT, b128_DATA);
const char b256_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10110011, 0b10001010, 0b10010011, 0b10100000, 0b10111011, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b10011010, 0b00100010, 0b00111010, 0b10101010, 0b00111010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10110011, 0b10001010, 0b10010011, 0b10100000, 0b10111011, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b10011010, 0b00100010, 0b00111010, 0b10101010, 0b00111010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b256_WIDTH 16/8
#define b256_HEIGHT 15
// greyPutSprite(x, y, b256_WIDTH, b256_HEIGHT, b256_DATA);
const char b512_DATA[] ={0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10111001, 0b10100011, 0b10110001, 0b10001001, 0b10110011, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00110010, 0b00001010, 0b00010010, 0b00100010, 0b10111010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b512_WIDTH 16/8
#define b512_HEIGHT 15
// greyPutSprite(x, y, b512_WIDTH, b512_HEIGHT, b512_DATA);
const char b1024_DATA[] ={0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10100100, 0b11101010, 0b10101010, 0b10101010, 0b11110100, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11010010, 0b00110110, 0b01011110, 0b10000110, 0b11100110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b1024_WIDTH 16/8
#define b1024_HEIGHT 15
// greyPutSprite(x, y, b1024_WIDTH, b1024_HEIGHT, b1024_DATA);
const char b2048_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b10011010, 0b11100100, 0b11010100, 0b10110101, 0b10001011, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11100010, 0b10101010, 0b00100010, 0b10101010, 0b10100010, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110};
#define b2048_WIDTH 16/8
#define b2048_HEIGHT 15
// greyPutSprite(x, y, b2048_WIDTH, b2048_HEIGHT, b2048_DATA);
const char b4096_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b10111011, 0b10100101, 0b10000101, 0b11100101, 0b11101011, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b00010010, 0b01001110, 0b00000010, 0b11001010, 0b00100010, 0b11111110, 0b11111110, 0b11111110, 0b11111110, 0b11111110};
#define b4096_WIDTH 16/8
#define b4096_HEIGHT 15
// greyPutSprite(x, y, b4096_WIDTH, b4096_HEIGHT, b4096_DATA);
const char b8192_DATA[] ={0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11110100, 0b11011100, 0b11110100, 0b11010100, 0b11111110, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111010, 0b10100110, 0b11101010, 0b00110010, 0b11011110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110, 0b11111111, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11110100, 0b11011100, 0b11110100, 0b11010100, 0b11111110, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b11111111, 0b11111110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111010, 0b10100110, 0b11101010, 0b00110010, 0b11011110, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b11111110};
#define b8192_WIDTH 16/8
#define b8192_HEIGHT 15
// greyPutSprite(x, y, b8192_WIDTH, b8192_HEIGHT, b8192_DATA);



const char scoreboard_DATA[] ={0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10011110, 0b00011100, 0b00001000, 0b01110001, 0b10010001, 0b00100010, 0b00011000, 0b10001001, 0b10000001, 0b00100010, 0b00011000, 0b10001001, 0b10000001, 0b00100010, 0b00101000, 0b10001001, 0b10000010, 0b00100010, 0b01001000, 0b01110001, 0b10000100, 0b00100010, 0b01001000, 0b10001001, 0b10001000, 0b00100010, 0b11111110, 0b10001001, 0b10010000, 0b00100010, 0b00001000, 0b10001001, 0b10011111, 0b00011100, 0b00001000, 0b11110001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10100010, 0b10000000, 0b00000000, 0b00000001, 0b10100010, 0b10000000, 0b00000000, 0b00000001, 0b10111001, 0b00000000, 0b00000000, 0b00000001, 0b10101001, 0b00000000, 0b00000000, 0b00000001, 0b10111001, 0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000000, 0b00000000, 0b00000001, 0b10111001, 0b00001110, 0b10010100, 0b01110001, 0b10101000, 0b00010000, 0b10100100, 0b01000001, 0b10101001, 0b00100000, 0b11000100, 0b01000001, 0b10101001, 0b00100000, 0b11000100, 0b01110001, 0b10111001, 0b00100000, 0b10100100, 0b01000001, 0b10100001, 0b00010000, 0b10100100, 0b01000001, 0b10100001, 0b00001110, 0b10010111, 0b01110001, 0b11111111, 0b11111111, 0b11111111, 0b11111111};

const char* NUM_DATA[] = {b2_DATA, b4_DATA, b8_DATA, b16_DATA, b32_DATA, b64_DATA, b128_DATA, b256_DATA, b512_DATA, b1024_DATA, b2048_DATA, b4096_DATA, b8192_DATA};

void renderBoard(){
	__asm
		ld hl, #animation_values
		push hl
		pop ix
		call _clearGreyScaleBuffer

		ld hl, #gameData

		ld d, #0
		X_BOARD_LOOP:
			ld e, #0
			Y_BOARD_LOOP:


				ld b, #0
				ld c, (hl)
				push hl

				ld	hl, #__xinit__NUM_DATA // bc = NUM_DATA[gameData[i]]
				add hl, bc
				add hl, bc
				ld c, (hl)
				inc hl
				ld b, (hl)
				push	bc
				

				ld	hl, #0x0f02 // magic size number
				push	hl
				xor	a, a



				ld (0x8478), de

				ld a, (ix)
				add d
				ld d, a
				inc ix

				ld a, (ix)
				add e
				ld e, a
				inc ix
				
				push	de



				call	_greyPutSprite
				ld de, (0x8478)
				ld	hl, #6
				add	hl, sp
				ld	sp, hl

				pop hl
				inc hl

				ld a, e
				add a, #14
				ld e, a
				cp a, #14*4
				jp nz, Y_BOARD_LOOP


			ld a, d
			add a, #14
			ld d, a
			cp a, #14*4
			jp nz, X_BOARD_LOOP



	__endasm;

}

void set(){
	__asm

		xor a, a
		ld hl, #animation_values
		ld (hl), a
		ld de, #animation_values+1
		ld bc, #32
		ldir
	__endasm;
	char* dataLoc=getOrCreateVar(dataName, 20)+2; 

	if (!(dataLoc[0] == 0x69 && dataLoc[3] == 0x69)){
		dataLoc[0] = 0x69;
		dataLoc[1] = 0x9F;
		dataLoc[2] = 0x15;
		dataLoc[3] = 0x69;
	}
	*(char*)(0x85A6) = dataLoc[1];
	*(char*)(0x85A6+1) = dataLoc[2];


	


	getOrCreateVar(gameName, 20); 
	__asm
		inc hl
		inc hl
		ld a, (hl)
		cp #0x69
		jp nz, NOT_RIGHT

			ld de, #gameData
			ld bc, #20
			ldir

			ld	sp, ix
			pop	ix
			ret
		NOT_RIGHT:
			xor a, a
			ld hl, #gameData
			ld (hl), a
			ld de, #gameData+1
			ld bc, #19
			ldir

	__endasm;


}



void real_main(){
	clearScreen();
	setCpuSpeed(3);
	
	



	set();
	*((char*)gameData) = 1;
	*((char*)gameData+1) = 2;
	*((char*)gameData+2) = 3;
	*((char*)gameData+3) = 4;
	*((char*)gameData+4) = 5;
	renderBoard();

	INIT_GREYSCALE();
	
	*(char*)WAIT_LOC = *(char*)(0x85A6);
	*(char*)CONTRAST_LOC = *(char*)(0x85A6+1);
	
	setCpuSpeed(3);
	// greyPutSprite(10, 5, Untitled4_WIDTH, Untitled4_HEIGHT, Untitled4_DATA);

	*((char*)MAX_COL)=8;

	*((char*)START_ROW) = ROW_CONST+3;
	*((char*)END_ROW) = ROW_END_CONST-3;

	while (1){
		wait(4);



		// render scoreboard

		swap(); 
		__asm
			ld a, #15
			ld (#penRow), a
			ld a, #67
			ld (#penCol), a
			push ix
		__endasm;
		fputs("Score:");
		__asm
		ld a, #15+8
		ld (#penRow), a
		ld a, #67
		ld (#penCol), a
		__endasm;
		number(1234);
		__asm
		ld a, #15+8+8
		ld (#penRow), a
		ld a, #67
		ld (#penCol), a
		__endasm;

		fputs("Time:");
		__asm
		ld a, #15+8+8+8
		ld (#penRow), a
		ld a, #67
		ld (#penCol), a
		
		__endasm;
		number(1234);


		__asm
			pop ix
		__endasm;




		scanKeys();
		if (skClear == lastPressedKey())
			break;
		else if (skMode == lastPressedKey()){
			clearScreen();
			calibration_loop();
			clearScreen();
			clearGreyScaleBuffer();

			greyPutSprite(4+0, 0, b2_WIDTH, b2_HEIGHT, b2_DATA);
			greyPutSprite(4+14, 0, b4_WIDTH, b4_HEIGHT, b4_DATA);
			greyPutSprite(4+14*2, 0, b8_WIDTH, b8_HEIGHT, b8_DATA);
			greyPutSprite(4+14*3, 0, b16_WIDTH, b16_HEIGHT, b16_DATA);
			greyPutSprite(4+0, 14, b32_WIDTH, b32_HEIGHT, b32_DATA);
			greyPutSprite(4+14, 14, b64_WIDTH, b64_HEIGHT, b64_DATA);
			greyPutSprite(4+14*2, 14, b128_WIDTH, b128_HEIGHT, b128_DATA);
			greyPutSprite(4+14*3, 14, b256_WIDTH, b256_HEIGHT, b256_DATA);
			greyPutSprite(4+0, 14*2, b512_WIDTH, b512_HEIGHT, b512_DATA);
			greyPutSprite(4+14, 14*2, b1024_WIDTH, b1024_HEIGHT, b1024_DATA);
			greyPutSprite(4+14*2, 14*2, b2048_WIDTH, b2048_HEIGHT, b2048_DATA);
			greyPutSprite(4+14*3, 14*2, b4096_WIDTH, b4096_HEIGHT, b4096_DATA);
			greyPutSprite(4+0, 14*3, b8192_WIDTH, b8192_HEIGHT, b8192_DATA);
		}

	}

	archive(dataName);


}

void main() {
	clearScreen();
	resetPen();


	real_main();



	

}